# Prometheus Configuration for LMS Backend
# Standalone Observability Deployment
# Scrapes metrics from backend Node.js application every 15 seconds

global:
    scrape_interval: 15s # How often to scrape targets
    evaluation_interval: 15s # How often to evaluate rules
    scrape_timeout: 10s # Timeout for scrape requests

    # Attach these labels to all time series
    external_labels:
        monitor: "lms-monitor"
        environment: "production"

# Alertmanager configuration
alerting:
    alertmanagers:
        - static_configs:
              - targets:
                    - alertmanager:9093
          scheme: http
          timeout: 10s

# Alert rules configuration
rule_files:
    - "/etc/prometheus/alerts.yml"
    - "/etc/prometheus/alerts_comprehensive.yml"
    - "/etc/prometheus/recording_rules.yml"

# Scrape configurations
scrape_configs:
    # LMS Backend Application Metrics - PRODUCTION
    # Scraping from deployed website at https://lms.c3ihub.iitk.ac.in
    # Uses x-api-key header for authentication
    - job_name: "lms-backend"
      metrics_path: "/api/v1/observability/prometheus-metrics"
      
      # HTTPS scheme for production
      scheme: https
      
      # TLS configuration
      tls_config:
          # Set to true if using self-signed certificate, false for valid SSL
          insecure_skip_verify: false
      
      # Send API key via Authorization header (Prometheus standard)
      authorization:
          type: "ApiKey"
          credentials: "04VCjkU5TrL5biVxEnTzANj8TxJWJd4M"
      
      static_configs:
          - targets: ["lms.c3ihub.iitk.ac.in"]
            labels:
                service: "lms-backend"
                environment: "production"
                instance: "production-backend"

    # Prometheus Self-Monitoring
    - job_name: "prometheus"
      static_configs:
          - targets: ["localhost:9090"]
            labels:
                service: "prometheus"
