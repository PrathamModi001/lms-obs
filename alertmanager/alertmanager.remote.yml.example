# =============================================================================
# Alertmanager Configuration for REMOTE LMS Backend
# =============================================================================
# Use this configuration when:
# - Backend is deployed on a remote server
# - Alertmanager runs locally
#
# Changes from local config:
# - Webhook URLs point to deployed backend
# =============================================================================

global:
  resolve_timeout: 5m
  
  # SMTP Configuration (keep same as before)
  smtp_smarthost: 'smtp.c3ihub.iitk.ac.in:587'
  smtp_from: 'lms@c3ihub.iitk.ac.in'
  smtp_auth_username: 'lms'
  smtp_auth_password: 'Sekf589@R'
  smtp_auth_identity: 'lms'
  smtp_require_tls: true
  smtp_hello: 'localhost'
  
  smtp_tls_config:
    insecure_skip_verify: true

templates:
  - '/etc/alertmanager/templates/*.tmpl'

route:
  receiver: 'default-receiver'
  group_by: ['alertname', 'severity', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  
  routes:
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 1h
      continue: false
    
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 1m
      repeat_interval: 6h
      continue: false
    
    - match_re:
        alertname: '.*Down.*'
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 30m

inhibit_rules:
  - source_match:
      alertname: 'BackendDown'
    target_match:
      service: 'lms-backend'
    equal: ['instance']
  
  - source_match:
      alertname: 'PrometheusDown'
    target_match_re:
      alertname: '.*'
    equal: []

# =============================================================================
# RECEIVERS - Update webhook URLs for remote deployment
# =============================================================================
receivers:
  # Default receiver
  - name: 'default-receiver'
    webhook_configs:
      # CHANGE: Point to deployed backend
      - url: 'https://YOUR_SERVER_DOMAIN/v1/observability/alerts/webhook'
        send_resolved: true
        # Optional: Add API key if your webhook requires authentication
        # http_config:
        #   authorization:
        #     type: "ApiKey"
        #     credentials: "YOUR_API_KEY"

  # Critical alerts receiver
  - name: 'critical-alerts'
    webhook_configs:
      - url: 'https://YOUR_SERVER_DOMAIN/v1/observability/alerts/webhook'
        send_resolved: true
    
    email_configs:
      - to: 'prathammodi001@gmail.com'
        send_resolved: true
        headers:
          subject: 'CRITICAL: {{ .GroupLabels.alertname }} - LMS Alert'

  # Warning alerts receiver
  - name: 'warning-alerts'
    webhook_configs:
      - url: 'https://YOUR_SERVER_DOMAIN/v1/observability/alerts/webhook'
        send_resolved: true
    
    email_configs:
      - to: 'prathammodi001@gmail.com'
        send_resolved: true
        headers:
          subject: 'WARNING: {{ .GroupLabels.alertname }} - LMS Alert'
